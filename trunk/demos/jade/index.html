<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="file:///Users/paladin/Work/emp-ria/demos/jade/jquery-1.9.1.min.js" type="text/javascript"></script>
    <script src="file:///Users/paladin/Work/emp-ria/demos/jade/runtime.js" type="text/javascript"></script>
    <script src="file:///Users/paladin/Work/emp-ria/demos/jade/jade.js" type="text/javascript"></script>

    <script type="text/jade" id="mixins">
mixin ActionLink(controller, action)
    -attributes['data-controller'] = controller;
    -attributes['data-action'] = action;
    -attributes.href = 'javascript:';
    -if (arguments.length > 2) (attributes['data-params'] = [].slice.call(arguments, 2).map(function(_) { return JSON.stringify(_.valueOf ? _.valueOf() : _)}).join(','));
    a(attributes)
        block

mixin ActionForm(controller, action)
    -attributes['data-controller'] = controller;
    -attributes['data-action'] = action;
    -attributes.action = 'javascript:';
    form(attributes)
        block

    </script>

    <script type="text/jade" id="test">
#me.test
    +ActionLink('space', 'view', star.x, star.y)(checked):= star.name
    +ActionForm('space', 'goto')
        label(for="m")= $L('label')
        input#m(name="me", value=$L('value'))

    </script>

    <script type="text/javascript">
        jQuery(document).ready(function () {
            var mixins = jQuery('#mixins').text();
            var test = jQuery('#test').text();
            //jQuery('<pre></pre>').text(jade.compile(mixins, {client:true, compileDebug: false}).toString()).appendTo('body');

            var attrs = jade.attrs,
                escape = jade.escape,
                rethrow = jade.rethrow,
                merge = jade.merge;

            window.$L = function (_) { return _; };

            window.ActionLink_mixin = function(controller, action){
                var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {}, buf = this.buf;
                attributes['data-controller'] = controller;
                attributes['data-action'] = action;
                attributes.href = 'javascript:';
                if (arguments.length > 2) (attributes['data-params'] = escape([].slice.call(arguments, 2).map(function(_) { return JSON.stringify(_.valueOf ? _.valueOf() : _)}).join(',')));
                buf.push('<a');
                buf.push(attrs(merge({  }, attributes), merge({}, escaped, true)));
                buf.push('>');
                block && block();
                buf.push('</a>');
            };

            window.ActionForm_mixin = function(controller, action){
                var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {}, buf = this.buf;
                attributes['data-controller'] = controller;
                attributes['data-action'] = action;
                attributes.action = 'javascript:';
                buf.push('<form');
                buf.push(attrs(merge({  }, attributes), merge({}, escaped, true)));
                buf.push('>');
                block && block();
                buf.push('</form>');
            };

            var fn = Jade.compile(test, {client:true, compileDebug: false});
            jQuery('<pre></pre>').text(fn.toString()).appendTo('body');
            var res = fn({star:{x:1,y:'2',name:'name'}});
            console.info(res);
            jQuery('<pre></pre>').text(res).appendTo('body');
        })
    </script>
</head>
<body>

</body>
</html>