<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="file:///Users/paladin/Work/emp-ria/demos/jade/jquery-1.9.1.min.js" type="text/javascript"></script>
    <script src="file:///Users/paladin/Work/emp-ria/demos/jade/jade.js" type="text/javascript"></script>

    <script type="text/jade" id="mixins">
mixin ActionLink(controller, action)
    -attributes['data-controller'] = escape(controller);
    -attributes['data-action'] = escape(action);
    -attributes.href = attributes.href || 'javascript:';
    -if (arguments.length > 2) (attributes['data-params'] = escape([].slice.call(arguments, 2).map(function(_) { return JSON.stringify(_.valueOf ? _.valueOf() : _)}).join(',')));
    a(attributes)
        block

mixin ActionForm(controller, action)
    -attributes['data-controller'] = escape(controller);
    -attributes['data-action'] = escape(action);
    -attributes.action = attributes.action || 'javascript:';
    form(attributes)
        block

mixin RenderWithSingle(obj, tplClass)
    -var tpl = new tplClass
    -var tpl.assign(obj)
    -var tpl.options(attributes)
    -buf.push(tpl.renderBuffer())

mixin RenderWith(obj, tpl)
    -attributes.block = block
    if 'number' == typeof obj.length
        each value, key in obj
            -attributes.collectionIndex=key
            -attributes.collection=obj
            +RenderWithSingle(value, tpl)(attributes)
    else
        +RenderWithSingle(obj, tpl)(attributes)

    </script>

    <script type="text/jade" id="test">
#me.test
    +ActionLink('space', 'view', star.x, star.y)(title=$L('title... he he he')):= star.name
    +ActionForm('space', 'view')
        label(for="m")= $L('label')
        input#m(name="me", value=$L('value'))

    </script>

    <script type="text/javascript">
        jQuery(document).ready(function () {
            var mixins = jQuery('#mixins').text();
            var test = jQuery('#test').text();
            //jQuery('<pre></pre>').text(jade.compile(mixins, {client:true, compileDebug: false}).toString()).appendTo('body');

            window.$L = function (_) { return _; };

            var fn = Jade.compile(mixins, {client:true, compileDebug: false, globalizeMixins: true });
            jQuery('<pre></pre>').text(fn.toString()).appendTo('body');

            /*var fn = Jade.compile(test, {client:false, compileDebug: false });
            //jQuery('<pre></pre>').text(fn.toString()).appendTo('body');
            var res = fn({star:{x:1,y:'2',name:'name'}});
            jQuery('<pre></pre>').text(res).appendTo('body');*/
        })
    </script>
</head>
<body>

</body>
</html>